<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">

<dom-module id="todo-app">
  <template>
    <ul>
    <template is="dom-repeat" items="[[reply.tickets]]" as="ticket">
      <style>
        span[done]{
          text-decoration: line-through;
        }
      </style>
      <li><span done$={{ticket.end_time}}>
          {{ticket.id}}: {{ticket.detail}} 
            <span>{{_timeLapsed(ticket.start_time, ticket.end_time)}} </span>
          </span>
          <ol>
            <template is="dom-repeat" items="{{ticket.todos}}" as="todo">
              <li><span done$={{todo.done}}>
                  {{todo.item}}
                  </span>
              </li>
            </template>
          </ol>
      </li>
    </template>
    </ul>

    <iron-ajax
      auto
      id="requestData"
      url="/data"
      handleAs="json"
      on-response="handleResponse">
    </iron-ajax>
  </template>

  <script>
    Polymer({
      is: "todo-app",
      properties: {
        reply: {
          type: Object
        }
      },
      handleResponse: function (data){
        this.reply=data.detail.response;
      },
      _timeLapsed: function (start_time, end_time){
        time = end_time == null? Date.now() : Date.parse(end_time);
        icon = end_time == null?  "\u2615 " : "\u2705 done in ";
        var span = time - Date.parse(start_time);
        var days = Math.floor(span/86400000);
        if (days > 0) {
          return icon + " day " + days;
        }
        return icon + Math.floor(span/3600000) + " hour(s) ";
      }
    });
  </script>
</dom-module>
